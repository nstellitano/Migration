<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head lang="en">

    <title>Migration as an Instrument for International Development </title>
    <meta charset="UTF-8">

</head>

<!--Load Libraries-->
<script src="js/d3.min.js"></script>
<script src="js/topojson.v1.min.js"></script>
<script src="js/colorbrewer.js"></script>
<script src = "http://d3js.org/queue.v1.min.js"></script>
<script src="libs/jquery/jquery-2.1.1.min.js" charset="utf-8"></script>



<!-- add own vis classes-->
<script src = "js/map.js"></script>
<script src = "js/scatter.js"></script>
<script src = "js/OECDBAR.js"></script>
<script src = "js/stackbar.js"></script>
<script  src= "js/sankey.js"></script>
<script  src = "js/migration_flow_sankey.js"></script>
<!--<script  src = "js/INFO.js"></script>-->


<!--Stylesheets-->
<link rel="stylesheet" type="text/css" href="libs/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="css/colorbrewer.css">
<link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700' rel='stylesheet' type='text/css'>

<!-- add own stylesheet-->
<link rel="stylesheet" type="text/css" href="css/myStyle.css">






<body>

<!--Setup the overall structure of the website-->
<div class = "container">
    <div id="header" class="header">
        <h1>Migration as an Instrument for International Development</h1>

    </div>




        <div  id = "dashboard" class="dashboard">
            <form>


                <input type="radio" name="layout" value="Wage" id = "Wage"  checked> Wage Comparison 2010
                <!--<label><input type="radio" name="layout" value="Remittance" id = "Remittance" > Remittance</label>-->
                <!--<label><input type="radio" name="layout" value="Aid" id = "Aid"> Aid</label>-->
                <input type="radio" name="layout" value="Migrant" id = "Migrant"> Migrant Flows 1980-2010

            </form>

        </div>


    <div  id = "graph_1" class="graph grid_8">

        <!--<p>Graph 1</p>-->
        <h3 style="margin-top: 0px; margin-bottom: 1px">Extra Annual Wage Earned</h3>
        <form>
            <b>
                Compare: <input name="compare" value="compare" id = "compare" type="radio">
                Don't Compare: <input name="compare" value="dcompare" id = "dcompare" type="radio" check>
            </b>
        </form>
        <b>Aggregated by:
            <form>
                <input name="oecd" value="migrant_stock" id = "migrant_stock" type="radio" checked>Migrant Stock
                <input name="oecd" value="per_capita" id = "per_capita" type="radio" checked >Per Capita
            </form></b>
    </div>




    <div  id = "description" class="description">
        <p><b><u>Our story</u></b></p>
        <p style="text-align: left">
            In our dataset, we have a list of 20 non-OECD countries and 8 OECD countries.
            For each of these countries, we have wage information by education level from 2010 that we received from the World Bank.
            The first box below shows average/total (depending on the selection) wage differentials in wages for the selected list of non-OECD and OECD countries.
            The second box shows total/average remittance flows and the thid box shows total/average aid flows. The three education levels are defined as Level I (No Education), Level II (Secondary Education), and Level III (Post Secondary Education).
        </p>

        <div  id = "counterW" class="counterW">
            <label id="amounter_earnedW">Total Wage Differential</label>
            <h3 style="color: white" id = "totalW">$5,000,000,000</h3>
        </div>

        <div  id = "counterA" class="counterA">
            <label id="amounter_earnedA">Total Aid</label>
            <h3 style="color: white" id = "totalA">$5,000,000,000</h3>
        </div>

        <div  id = "counterR" class="counterR">
            <label id="amounter_earnedR">Total Remittance</label>
            <h3 style="color: white" id = "totalR">$5,000,000,000</h3>
        </div>
    </div>




    <div  id = "country_list" class="country_list">
        <p><b><u>Selected Countries</u></b></p>
        <p>
            Displays Selected Countries
        </p>
    </div>
    <div  id = "world_map" class="world_map">
    </div>
    <div  id = "description4" class="description4">
        <p><b><u>Migration flows over the last 30 years</u></b></p>
        <p style="text-align: left">
            To complete our visualization picture, we tell the story of how migration has evolved over the last 35 years.
            Utilizing data from 1980-2015 over a five year interval, we show the flow of male and female migrants from 195 non-OECD countries to 20 OECD countries by gender and education level.
            By clicking on the "By OECD" radio button, we can see flows into each individual OECD country.
            For example, we can see that in 1980, Canada allowed equal proportions of high-skilled and low-skilled migrants into the country.
            Fast forward to 2010, and it is selectively letting in many more high-skilled than low-skilled migrants.
        </p>
    </div>


    <div  id = "sankey_dash" class="sankey_dash">
        <h3>Migrant Stock Across Gender and Time</h3>
        <p>
            1980: <input name="slider-time" value= 1980 id = "_1980" type="radio" checked>
            1985: <input name="slider-time" value= 1985 id = "_1985" type="radio" >
            1990: <input name="slider-time" value= 1990 id = "_1990" type="radio" >
            1995: <input name="slider-time" value= 1995 id = "_1995" type="radio" >
            2000: <input name="slider-time" value= 2000 id = "_2000" type="radio" >
            2005: <input name="slider-time" value= 2005 id = "_2005" type="radio" >
            2010: <input name="slider-time" value= 2010 id = "_2010" type="radio" >

        </p>
        <form>


            <b>
                By Education: <input name="sankey_type" value="sankey_ed" id = "sankey_ed" type="radio" checked>
                By OECD: <input name="sankey_type" value="sankey_oecd" id = "sankey_oecd" type="radio" >
            </b>
        </form>

    </div>

    <div  id = "sankey" class="sankey">

    </div>




    <div id="under_overlay" class = "under_overlay">

    </div>

    <div id = "overlay" class="overlay">
        <h3>Welcome to Migration as an Instrument for International Development</h3>
        <p>This is our attempt to visualize migration flows from developing or what we call "non-OECD" countries to developed or "OECD" countries.
            In order to assess the different metrics that migrants benefit from, we compare wage differentials among developing and developed nations and compare that to remittances and aid.
        Push botton to continue</p>

        <div id="loading">
            <img src="css/ajax-loader.gif" alt="Loading..." />
        </div>

        <div>
            <label>
                <p>

                    <a href="#" ID ="button" class="myButton">Continue</a>
                </p>
            </label>
        </div>

    </div>

    <div id="data_layout" class = "data_layout">
        <div  id = "scatterVis" class="graph grid_8">
            <h3>Average Extra Annual Wage Earned vs Migrant Stock</h3>
            <b>Skill Level:</b>
            <input name="a" id = "low" value="lowskill" type="checkbox" checked >Low Skill
            <input name="a" id = "medium" value="medskill" type="checkbox" checked  >Medium Skill
            <input name="a" id = "high" value="highskill" type="checkbox" checked >High Skill
        </div>


        <div  id = "description1" class="description1">
            <p><b><u>Scatter Plot</u></b></p>
            <p style="text-align: left">
                Each dot on the plot to your left is a country's relative position in the migrant stock - average extra annual wage earned axes.
                Hovering over a dot provides the name of the country.
            </p>
            <p style="text-align: left">
                Brushing a dot or a list of dots changes other features of the visualization accordingly.
                For example, brushing the right-most green dot shows Pakistan's relative position in the graph and updates the bar plots as well as the corresponding gains estimate above the map layout.
                By migrating to OECD countries, the <u><span style="color: green">270,000</span></u> or so Pakistani high-skilled migrants, gained on an average <u><span style="color: green">$35,000</span></u> in wages in 2010.
            </p>
        </div>


        <div  id = "stackbarVis" class="graph grid_8">
            <h3>Average wage differentials in comparison to Remittances/Aid</h3>

        </div>

        <div  id = "description2" class="description2">
            <p><b><u>Bar Plot</u></b></p>
            <p style="text-align: left">
                Each blue bar to the left shows the total wage differential (average wage differential X total migrant stock) among migrants from a particular non-OECD country to the average wages in the OECD country.
                Because total remittances and aid flows are orders of magnitude lower in comparison to wage differentials, we have implemented a slider with a log scale that allows you to see the other two metrics of comparison.
            </p>
            <p style="text-align: left">
                Clicking on a country updates other visuals and estimates for gains accordingly. For example, in 2010, Nepal had around <u><span style="color: blue">50,000</span></u> migrants in OECD countries.
                If we sum up the average wages gained by each of those migrants by moving to a OECD country, we come up with the estimate of <u><span style="color: blue">$1,250,000,000</span></u>.
            </p>
        </div>
        <div  id = "footers" class = "footers" >
            <p>This Website was created by Samik Adhikari and Nicholas Stellitano.  Both are students at the Harvard Kennedy School </p>

            <li><a href="https://www.youtube.com/watch?v=TzdWsYaYuoc">Video</a></li>
            <li><a href="http://adhikarisamik.github.io/data/process_book.pdf">Process Book </a></li>
        </div>
    </div>
</div>




<script>
$(function() {


    var MyEventHandler = new Object()
    sank = new sankey_chart(d3.select("#sankey"))

    document.getElementById("sankey_dash").style.display = "none";
    document.getElementById("sankey").style.display = "none";
    document.getElementById("description4").style.display = "none";

    var cdata, ccapitals, alldata;
    var last_name;
    var scatter_vis
    var stackbar_vis
    var oecd_bar, oecd_bar1, count=0;
    var non_oecd = ["Argentina", "Colombia", "Dominican Republic", "Ecuador", "Ethiopia", "Honduras", "Indonesia",
        "Jordan", "Mauritius", "Mongolia", "Nepal", "Pakistan", "Panama", "Paraguay", "Peru", "Rwanda", "South Africa", "Uruguay", "Zambia"]

    //------------Load the Data and begin-------------------------------------------------------------------------------------------------------------------------------
    //-------------------------------------------------------------------------------------------------------------------------------------------------

    queue()
            .defer(d3.csv, "data/countries-data.csv")
            .defer(d3.json, "data/capitals.json")
            .defer(d3.json, "data/master_data_set.json")
            .defer(d3.json, "data/world-topo-110m.json")
            .defer(d3.json, "data/1980.json")
            .defer(d3.json, "data/1985.json")
            .defer(d3.json, "data/1990.json")
            .defer(d3.json, "data/1995.json")
            .defer(d3.json, "data/2000.json")
            .defer(d3.json, "data/2005.json")
            .defer(d3.json, "data/2010.json")
            .await(ready)
    //Ready function takes the data files loaded via the queue function and begins with loading the WorldMap
    function ready(error, countries, capitals, AllData, topo, _1980, _1985, _1990, _1995, _2000, _2005, _2010) {
        cdata = countries;
        ccapitals = capitals
        alldata = AllData;

        $("#button").click(function(){
            document.getElementById("overlay").style.display = "none";
            document.getElementById("under_overlay").style.display = "none";

        });


        $().ready(function() {
            $("#loading").hide();
        });



        //Make a WorldMap via the worldmap object
        world_map = new WorldMap(d3.select("#world_map"), cdata, ccapitals, alldata, MyEventHandler, topo, _1980, _1985, _1990, _1995, _2000, _2005, _2010);




        scatter_vis = new ScatterVis(d3.select("#scatterVis"), alldata, MyEventHandler);
        stackbar_vis = new StackbarVis(d3.select("#stackbarVis"), alldata, MyEventHandler);
        oecd_bar = new OECDBAR(d3.select("#graph_1"), alldata, MyEventHandler)
        oecd_bar.wrangledata(non_oecd);
        world_map.heatmap()
        changeDivHTML(non_oecd);



    //------------Events-------------------------------------------------------------------------------------------------------------------------------
    //-------------------------------------------------------------------------------------------------------------------------------------------------

    $(MyEventHandler).bind("map_selection", function (event, name) { //input name is 1 country in array format

        last_name = [name];
        //world_map.draw_arcData(last_name)
        oecd_bar.wrangledata([name])
        stackbar_vis.wrangleData([name])
        //stack
        //scatter
        changeDivHTML(last_name);


    });

        $(MyEventHandler).bind("oecd_selection", function (event, name) { //input name is 1 country in array format


    });

        $(MyEventHandler).bind("scatter_selection", function (event, name, name1, name2, name3, name4, name5, name6, name7, name8, name9, name10, name11, name12, name13, name14, name15, name16, name17, name18, name19) {//input name will be an array of names -> singular array or multiple array
                country_select = [name, name1, name2, name3, name4, name5, name6, name7, name8, name9, name10, name11, name12, name13, name14, name15, name16, name17, name18, name19];



            for(i=19; i>-1; i--){
                if((country_select[i]===undefined)){
                    country_select.splice(i,1)
                }
            }



            stackbar_vis.wrangleData(country_select);
            oecd_bar.wrangledata(country_select)

            changeDivHTML(country_select);


        });

        $(MyEventHandler).bind("nonoecd_selection", function (event, name) {//{input name is 1 country in array format

            console.log(name)
            oecd_bar.wrangledata(name)


        });
    d3.selectAll("input").on("change", function()
    {

        if(d3.select(this).attr("name")  == "oecd" || d3.select(this).attr("name")  == "compare"){

            oecd_bar.wrangledata(last_name)
        }

        if(d3.select(this).attr("name")  == "layout" && d3.select(this).attr("id")  == "Migrant"){



            document.getElementById("sankey_dash").style.display = "";
            document.getElementById("sankey").style.display = "";
            document.getElementById("description4").style.display = "";

            document.getElementById("data_layout").style.display = "none";
            document.getElementById("country_list").style.display = "none";
            document.getElementById("graph_1").style.display = "none";
            document.getElementById("description").style.display = "none";

            world_map.heatmap()




        }

        if(d3.select(this).attr("name")  == "layout" && d3.select(this).attr("id")  == "Wage") {


            world_map.heatmap();

            document.getElementById("sankey_dash").style.display = "none";
            document.getElementById("sankey").style.display = "none";
            document.getElementById("description4").style.display = "none";

            document.getElementById("graph_1").style.display = "";
            document.getElementById("data_layout").style.display = "";
            document.getElementById("country_list").style.display = "";
            document.getElementById("description").style.display = "";


        }

                if (d3.select(this).attr("name") == "slider-time") {

                    sank.update();

                    world_map.heatmap()
                }

        if (d3.select(this).attr("name") == "sankey_type") {

            sank.update();

            world_map.heatmap()
        }

        if(d3.select(this).attr("id")  == "low" || d3.select(this).attr("id")  == "medium" || d3.select(this).attr("id")  == "high") {

            scatter_vis.updateVis();
        }


    });


    function changeDivHTML(name)
    {

        //clear current list
        document.getElementById('country_list').innerHTML = ("<p><b><u>Selected Countries</u></b></p>");

        var previousInnerHTML = new String();

        previousInnerHTML = document.getElementById('country_list').innerHTML;

        for(i=0; i<name.length; i++)
        {
            if(i!=name.length-1) {
                previousInnerHTML = previousInnerHTML.concat("<h5>" + name[i] + "," + "<h5>")
            }else
            {
                previousInnerHTML = previousInnerHTML.concat("<h5>" + name[i] + "<h5>")
            }
        }

        document.getElementById('country_list').innerHTML = previousInnerHTML;

    }



    };


})
</script>

</body>
</html>
